import{j as s,u as v,r as o,L as y}from"./index-D11lsB9n.js";import{G as t}from"./GeneralValue-DtEkQ6Gt.js";function w({label:a,pValue:e,vValue:i}){return s.jsxs("div",{className:"power-item row",children:[s.jsx("div",{className:"power-title flex-1",children:a}),s.jsxs("div",{className:"power-value flex-1",children:[s.jsx("strong",{children:e})," W"]}),i!==void 0?s.jsxs("div",{className:"power-value flex-1",children:[s.jsx("strong",{children:i})," V"]}):s.jsx("span",{className:"power-value flex-1"})]})}function b({inverterData:a,isSocketConnected:e}){const{t:i}=v();return s.jsxs("div",{className:"pv flex-1",children:[s.jsxs("div",{className:"icon col align-center",children:[s.jsxs("div",{className:"col align-center",children:[s.jsx(t,{className:"show-small",value:e?a.p_pv:0,unit:" W"}),s.jsx("img",{src:"/assets/icon_solor_yielding.png"})]}),s.jsx("div",{className:`y-arrow ${a.p_pv==0||!e?"none":""}`})]}),s.jsxs("div",{className:"pv-texts power flex-1",children:[s.jsx(w,{label:i("PV1"),pValue:e?a.p_pv_1:0,vValue:e?a.v_pv_1:0}),s.jsx(w,{label:i("PV2"),pValue:e?a.p_pv_2:0,vValue:e?a.v_pv_2:0}),s.jsx(w,{label:i("totalPV"),pValue:e?a.p_pv:0})]})]})}function V({inverterData:a,isSocketConnected:e}){return s.jsx("div",{className:"battery flex-1",children:s.jsxs("div",{className:"row align-center",children:[s.jsxs("div",{className:"battery-texts",children:[s.jsx(t,{value:e?a.p_discharge||a.p_charge:0,unit:" W"}),s.jsx(t,{value:e?a.soc:0,unit:"%"}),s.jsx(t,{value:e?a.v_bat:0,unit:" Vdc"})]}),s.jsxs("div",{className:"col align-center",children:[s.jsx(t,{className:"show-small",value:e?a.p_discharge||a.p_charge:0,unit:" W"}),s.jsx("img",{className:"battery-icon",src:`/assets/icon_battery_${e?Math.round(a.soc/2/10):0}_green.png`}),s.jsx(t,{className:"show-small",value:e?a.soc:0,unit:"%"}),s.jsx(t,{className:"show-small",value:e?a.v_bat:0,unit:" Vdc"})]}),s.jsx("div",{className:"arrows row",children:Array.from({length:2}).map((i,l)=>s.jsx("div",{className:`x-arrow ${e?a.p_discharge>0?"right":a.p_charge>0?"left":"none":"none"}`},"batter-arrow-"+l))})]})})}const E=(a,e)=>e?a.p_inv>0?"right":a.p_rec>0?"left":"none":"none";function $({inverterData:a,isSocketConnected:e}){return s.jsx("div",{className:"inverter flex-1",children:s.jsxs("div",{className:"row align-center",children:[s.jsx("img",{src:"/assets/inverter_off_grid_20231003.png"}),s.jsx("div",{className:"flex-1 arrows row justify-flex-end",children:Array.from({length:4}).map((i,l)=>s.jsx("div",{className:`x-arrow ${E(a,e)}`},`inverter-arrow-${l}`))})]})})}function L({inverterData:a,isSocketConnected:e}){const{vacr:i,vacs:l,vact:n,p_to_user:r,p_to_grid:d,fac:x}=a,f=o.useMemo(()=>{if(!e)return 0;const m=(i||l||n)/10;return m>300?0:m},[e,i,l,n]),p=o.useMemo(()=>e?r||d:0,[e,r,d]),h=o.useMemo(()=>e?x/100:0,[x,e]),j=o.useMemo(()=>e?d>0?"right":r>0?"left":"none":"none",[e,d,r]);return s.jsxs("div",{className:"grid flex-1 row align-center justify-flex-end",children:[s.jsx("div",{className:"row arrows",children:Array.from({length:2}).map((m,N)=>s.jsx("div",{className:`x-arrow ${j}`},"grid-arrow-"+N))}),s.jsxs("div",{className:"col align-center",children:[s.jsx(t,{className:"show-small",value:p,unit:" W"}),s.jsx("img",{src:"/assets/icon_grid.png"}),s.jsx(t,{className:"show-small",value:f,unit:" Vac"}),s.jsx(t,{className:"show-small",value:h,unit:" Hz"})]}),s.jsxs("div",{className:"grid-texts",children:[s.jsx(t,{value:p,unit:" W"}),s.jsx(t,{value:f,unit:" Vac"}),s.jsx(t,{value:h,unit:" Hz"})]})]})}function P({inverterData:a,isSocketConnected:e}){const{t:i}=v(),l=a.p_inv+a.p_to_user-a.p_rec;return s.jsx("div",{className:"consumption flex-1",children:s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col align-center consumption-icon",children:[s.jsx("div",{className:"arrows col",children:Array.from({length:2}).map((n,r)=>s.jsx("div",{className:`y-arrow ${e&&l>0?"down":"none"}`},"comsumption-arrow-"+r))}),s.jsx("img",{src:"/assets/icon_consumption.png"}),s.jsx(t,{className:"show-small",value:e?l:0,unit:" W"})]}),s.jsxs("div",{className:"consumption-texts",children:[s.jsx(t,{value:e?l:0,unit:" W"}),s.jsx("div",{className:"description",children:i("consumptionPower")})]})]})})}function W({inverterData:a,isSocketConnected:e}){const{t:i}=v(),l=e?a.p_eps:0,n=r=>l===0?s.jsx("strong",{className:`eps-status ${r||""}`,children:i("eps.standby")}):s.jsx(t,{className:r,value:l,unit:" W"});return s.jsx("div",{className:"eps flex-1",children:s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col align-center",children:[s.jsx("div",{className:`y-arrow ${l>0?"down":"none"}`}),s.jsx("img",{src:"/assets/icon_eps.png"}),n("show-small")]}),s.jsxs("div",{className:"eps-texts",children:[n(),s.jsx("div",{className:"description",children:i("eps.backupPower")})]})]})})}function A({inverterData:a,isSocketConnected:e,onReconnect:i,newNotificationTrigger:l}){const{t:n}=v(),[r,d]=o.useState(!1),[x,f]=o.useState([]),[p,h]=o.useState(!1),j=o.useRef(null),m=o.useRef(null),N=c=>new Date(c).toLocaleString(),_=()=>d(c=>!c),g=async()=>{h(!0);try{const u=await(await fetch("/notification-history")).json();f(u)}catch(c){console.error("Failed to fetch notifications",c)}finally{h(!1)}};return o.useEffect(()=>{r&&g()},[r]),o.useEffect(()=>{const c=()=>{document.hidden||g()};return document.addEventListener("visibilitychange",c),()=>document.removeEventListener("visibilitychange",c)},[]),o.useEffect(()=>{if(r){const c=u=>{j.current&&j.current.contains(u.target)||m.current&&m.current.contains(u.target)||d(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)}},[r]),o.useEffect(()=>{l&&(d(!0),g())},[l]),s.jsx(s.Fragment,{children:s.jsxs("div",{className:"card system-information",children:[s.jsxs("div",{className:"system-content",children:[s.jsxs("div",{className:"system-title",children:[s.jsx("span",{className:"system-title-text",children:n("systemInformation")}),s.jsx("span",{children:a.deviceTime}),s.jsx("div",{className:"notification-button",ref:m,children:s.jsx("button",{onClick:_,className:r?"active":"inactive",title:n("notification"),children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",viewBox:"0 0 24 24",strokeLinejoin:"round",className:"feather feather-bell",children:[s.jsx("path",{d:"M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"}),s.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]})})})]}),s.jsxs("div",{className:"system-graph",children:[s.jsxs("div",{className:"system-status row",children:[s.jsxs("div",{className:"system-status-display",title:a.status_text,children:[s.jsx("div",{className:`system-status-icon ${e?a.status!==0?"normal":"fault":"offline"}`}),s.jsx("div",{children:e?a.status!==0?n("normal"):n("fault"):n("offline")})]}),s.jsx("button",{className:"system-status-reconnect",onClick:i,title:n("reconnect"),disabled:e,children:n("reconnect")})]}),s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"flex-1"}),s.jsx(b,{inverterData:a,isSocketConnected:e}),s.jsx("div",{className:"flex-1"})]}),s.jsxs("div",{className:"row",children:[s.jsx(V,{inverterData:a,isSocketConnected:e}),s.jsx($,{inverterData:a,isSocketConnected:e}),s.jsx(L,{inverterData:a,isSocketConnected:e})]}),s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"flex-1"}),s.jsx(W,{inverterData:a,isSocketConnected:e}),s.jsx(P,{inverterData:a,isSocketConnected:e})]})]})]}),r&&s.jsx("div",{className:"notification-history notification-popover",children:s.jsxs("div",{className:"notification-popover-content",ref:j,children:[s.jsxs("div",{className:"notification-popover-header",children:[s.jsx("h3",{children:n("notification")}),s.jsx("button",{className:"close-popover",onClick:_,children:"Ã—"})]}),p?s.jsx(y,{}):x.length===0?s.jsx("div",{className:"notification-no-record",children:n("notificationNoRecords")}):s.jsx("ul",{children:x.map((c,u)=>s.jsxs("li",{children:[s.jsx("div",{children:s.jsx("strong",{children:c.title})}),s.jsx("div",{className:"notification-body",children:c.body}),s.jsx("div",{className:"notification-date",children:N(c.notified_at)})]},u))})]})})]})})}export{A as default};
