import{r as c,u as v,j as e}from"./index-BFUrLbEm.js";import{G as o}from"./GeneralValue-Bkkz45G1.js";import{C as b}from"./react-apexcharts.min-B6sFnS7Q.js";import{f as x,r as p}from"./utils-bN4E_OZW.js";function C({total:s,ePVDay:r}){const{t:i}=v();return e.jsxs("div",{className:"row justify-space-between align-center",children:[e.jsx("img",{src:"/assets/icon_solor_yielding.png"}),e.jsxs("div",{className:"yield-texts summary-item-content-texts ",children:[e.jsx(o,{value:r,unit:" kWh"}),e.jsx("div",{className:"description",children:i("yield.today")}),s&&e.jsxs(e.Fragment,{children:[e.jsx(o,{value:s.pv.toFixed(1),unit:" kWh"}),e.jsx("div",{className:"description",children:i("yield.total")})]})]})]})}const F=c.memo(C);function S({totalYield:s,charge:r,gridExport:i,label:a}){const{t:n}=v(),[d,y]=c.useState(!1);let l,t,u,m;return s?(l=s-r-i,t=x(l/s*100),u=x(r/s*100),m=x(i/s*100)):(l=0,t=0,u=0,m=0),c.useEffect(()=>{const h=window.matchMedia("(prefers-color-scheme: dark)");h.matches&&y(!0),h.addEventListener("change",g=>y(g.matches))},[]),e.jsxs("div",{className:"yield-chart row flex-1",children:[e.jsxs("div",{className:"texts col flex-1 align-start justify-space-between",children:[e.jsxs("div",{className:"yield-chart-load",children:[n("chart.consumption",{context:a})," ",t,"%"]}),e.jsxs("div",{className:"yield-chart-charge",children:[n("chart.batteryCharged",{context:a})," ",u,"%"]}),e.jsxs("div",{className:"yield-chart-export",children:[n("chart.exportToGrid",{context:a})," ",m,"%"]}),e.jsx("div",{className:"yield-chart-total",children:e.jsxs("strong",{children:[n("chart.total",{context:a})," ",p(s)," kWh"]})})]}),e.jsx("div",{className:"chart row align-center",children:e.jsx(b,{type:"pie",series:[p(l),p(r),p(i)],width:110,options:{colors:["#FF718F","#5CC9A0","#F2A474"],theme:{mode:d?"dark":"light"},labels:[n("chart.consumption",{context:a}),n("chart.batteryCharged",{context:a}),n("chart.exportToGrid",{context:a})],legend:{show:!1}}})})]})}const N=c.memo(S);function E({invertData:s}){const{i18n:r,t:i}=v(),[a,n]=c.useState(!1),[d,y]=c.useState(!1),l=c.useRef(!1),[t,u]=c.useState(),[m,h]=c.useState(0),g=c.useCallback(()=>{switch(m){case 0:h(1);break;case 1:h(2);break;default:h(0);break}},[m]),j=c.useCallback(async()=>{if(!l.current)try{console.log(r.t("fetchingTotal")),l.current=!0;const k=await(await fetch("/total")).json();u(k)}catch(_){console.error(r.t("fetchTotalError"),_)}finally{l.current=!1}},[r]),f=c.useCallback(()=>{document.hidden||j()},[j]);c.useEffect(()=>(j(),document.addEventListener("visibilitychange",f),()=>{document.removeEventListener("visibilitychange",f)}),[j,f]);const w=()=>{switch(m){case 0:return e.jsx(F,{total:t,ePVDay:s.e_pv_day});case 1:return e.jsx(N,{label:"today",totalYield:s.e_pv_day,charge:s.e_chg_day,gridExport:s.e_to_grid_day});case 2:return e.jsx(N,{label:"total",totalYield:(t==null?void 0:t.pv)||0,charge:(t==null?void 0:t.battery_charged)||0,gridExport:(t==null?void 0:t.grid_export)||0});default:return null}};return e.jsxs("div",{className:"summary row",children:[e.jsxs("div",{className:"yield summary-item flex-1 col",onClick:g,children:[e.jsx("div",{className:"summary-item-title",children:i("solarYield")}),e.jsx("div",{className:"summary-item-content col flex-1",children:w()})]}),e.jsxs("div",{className:"battery summary-item flex-1",onClick:()=>n(!a),children:[e.jsx("div",{className:"summary-item-title",children:i(a?"batteryCharged":"batteryDischarge")}),e.jsx("div",{className:"summary-item-content",children:e.jsxs("div",{className:"row justify-space-between align-center",children:[e.jsx("img",{src:"/assets/icon_battery_discharging.png"}),e.jsxs("div",{className:"summary-item-content-texts",children:[e.jsx(o,{value:a?s.e_chg_day:s.e_dischg_day,unit:" kWh"}),e.jsx("div",{className:"description",children:i(a?"chargedToday":"dischargedToday")}),t&&e.jsxs(e.Fragment,{children:[e.jsx(o,{value:x(a?t.battery_charged:t.battery_discharged),unit:" kWh"}),e.jsx("div",{className:"description",children:i("total",{context:a?"charged":"discharged"})})]})]})]})})]}),e.jsxs("div",{className:"feed summary-item flex-1",onClick:()=>y(!d),children:[e.jsx("div",{className:"summary-item-title ",children:i(d?"feedInEnergy":"import")}),e.jsx("div",{className:"summary-item-content",children:e.jsxs("div",{className:"row justify-space-between align-center",children:[e.jsx("img",{src:d?"/assets/icon_feed_in_energy.png":"/assets/icon_import.png"}),e.jsx("div",{className:"feed-texts summary-item-content-texts",children:e.jsxs("div",{className:"col",children:[e.jsx(o,{value:d?s.e_to_grid_day:s.e_to_user_day,unit:" kWh"}),e.jsx("div",{className:"description",children:i(d?"todayExport":"todayImport")}),t&&e.jsxs(e.Fragment,{children:[e.jsx(o,{value:x(d?t.grid_export:t.grid_import),unit:" kWh"}),e.jsx("div",{className:"description",children:i("total",{context:d?"export":"import"})})]})]})})]})})]}),e.jsxs("div",{className:"comsumption summary-item flex-1",children:[e.jsx("div",{className:"summary-item-title ",children:i("consumption")}),e.jsx("div",{className:"summary-item-content",children:e.jsxs("div",{className:"row justify-space-between align-center",children:[e.jsx("img",{src:"/assets/icon_consumption.png"}),e.jsxs("div",{className:"feed-texts summary-item-content-texts",children:[e.jsx(o,{value:(s.e_inv_day+s.e_to_user_day+s.e_eps_day-s.e_rec_day).toFixed(1),unit:" kWh"}),e.jsx("div",{className:"description",children:i("todayUsed")}),t&&e.jsxs(e.Fragment,{children:[e.jsx(o,{value:x(t.consumption),unit:" kWh"}),e.jsx("div",{className:"description",children:i("totalUsed")})]})]})]})})]})]})}const G=c.memo(E);export{G as default};
