import{r,u as N,j as o,L as $}from"./index-DdLU41En.js";import{C as H}from"./react-apexcharts.min-BlwzYKls.js";const E=r.forwardRef(({className:S},k)=>{const{t:s}=N(),u=s("chart.solarPV"),d=s("chart.battery"),f=s("chart.grid"),[i,y]=r.useState([]),[v,b]=r.useState(!1),m=r.useRef(!1),[n,j]=r.useState(!0),p=r.useRef(!1),A=r.useMemo(()=>{const t=[],e=[],a=[],C=[],w=[];return i.forEach(l=>{const h=new Date(l[1]).getTime();t.push({x:h,y:l[2]}),e.push({x:h,y:l[3]}),a.push({x:h,y:l[4]}),C.push({x:h,y:l[5]}),w.push({x:h,y:l[6]})}),[{name:u,data:t},{name:d,data:e},{name:f,data:a},{name:s("chart.consumption"),data:C},{name:s("chart.soc"),data:w}]},[d,f,u,i,s]),c=r.useCallback(async()=>{if(m.current)return;m.current=!0;const e=await(await fetch("/hourly-chart")).json();y(e),m.current=!1},[]);r.useImperativeHandle(k,()=>({updateItem(t){if(!n)return;const e=i[i.length-1];if(JSON.stringify(e)===JSON.stringify(t))return;const a=[...i];e[0]===t[0]?a.splice(i.length-1,1,t):a.push(t),y(a)}}));const g=r.useCallback(()=>{!document.hidden&&n&&(p.current=!0)},[n]),x=r.useCallback(()=>{p.current&&(c(),p.current=!1)},[c]);r.useEffect(()=>(c(),document.addEventListener("visibilitychange",g),document.addEventListener("click",x),()=>{document.removeEventListener("visibilitychange",g),document.removeEventListener("click",x)}),[c,n,x,g]),r.useEffect(()=>{const t=window.matchMedia("(prefers-color-scheme: dark)");t.matches&&b(!0),t.addEventListener("change",e=>b(e.matches))},[]);const R=r.useCallback(()=>{n||c(),j(!n)},[n,c]),D=r.useMemo(()=>{const t=new Date;return t.setHours(0,0,0,0),t},[]);return o.jsxs("div",{className:`card hourly-chart col ${S||""}`,children:[o.jsxs("div",{className:"row justify-space-between",children:[o.jsx("div",{className:"hourly-chart-title",children:s("hourlyChart")}),o.jsxs("div",{className:"row hourly-chart-buttons",children:[o.jsx("button",{onClick:R,children:s(n?"pauseAutoUpdate":"allowAutoUpdate")}),o.jsx("button",{disabled:!n,onClick:()=>c(),children:s("updateChart")})]})]}),o.jsx("div",{className:"hourly-chart-content col flex-1",children:i.length?o.jsx(H,{type:"line",height:400,series:A,options:{chart:{toolbar:{show:!1},zoom:{enabled:!1}},legend:{show:!0,position:"top",horizontalAlign:"right",clusterGroupedSeries:!1},colors:["rgb(112, 173, 70)","rgb(90, 155, 213)","rgb(246, 104, 103)","rgb(255, 164, 97)","rgb(128, 0, 128)"],stroke:{width:3},theme:{mode:v?"dark":"light"},xaxis:{type:"datetime",min:D.getTime(),labels:{datetimeUTC:!1,format:"HH:mm"}},yaxis:[{seriesName:u,title:{text:s("chart.power")}},{seriesName:u,show:!1},{seriesName:u,show:!1},{seriesName:u,show:!1},{seriesName:"SOC",opposite:!0,tickAmount:10,min:0,max:100,title:{text:"SOC (%)"}}],tooltip:{x:{format:"HH:mm:ss"},y:{formatter(t,e){return e.seriesIndex===4?`${t}%`:`${Math.abs(t)} W`},title:{formatter(t,e){if(t===d){const a=e.series[1][e.dataPointIndex];return a===0?`${t}:`:a<0?s("chart.batteryCharging",{seriesName:t}):s("chart.batteryDischarging",{seriesName:t})}if(t===f){const a=e.series[2][e.dataPointIndex];return a===0?`${t}:`:a<0?`${s("chart.importGridPower")}:`:`${s("chart.exportGridPower")}:`}return`${t}:`}}}}}}):o.jsx($,{})})]})});E.displayName="HourlyChart";const M=r.memo(E);export{M as default};
