import{r as s,j as n,L as A}from"./index-DKB4gB__.js";import{C as H}from"./react-apexcharts.min-ZuF0L6FM.js";const l="Solar PV",C="Battery",b="Grid",w=s.forwardRef(({className:E},S)=>{const[o,d]=s.useState([]),[k,x]=s.useState(!1),h=s.useRef(!1),[a,v]=s.useState(!0),f=s.useRef(!1),j=s.useMemo(()=>{const e=[],t=[],r=[],g=[],y=[];return o.forEach(c=>{const u=new Date(c[1]).getTime();e.push({x:u,y:c[2]}),t.push({x:u,y:c[3]}),r.push({x:u,y:c[4]}),g.push({x:u,y:c[5]}),y.push({x:u,y:c[6]})}),[{name:l,data:e},{name:C,data:t},{name:b,data:r},{name:"Consumption",data:g},{name:"SOC",data:y}]},[o]),i=s.useCallback(async()=>{if(h.current)return;h.current=!0;const t=await(await fetch("/hourly-chart")).json();d(t),h.current=!1},[d]);s.useImperativeHandle(S,()=>({updateItem(e){if(!a)return;const t=o[o.length-1];if(JSON.stringify(t)===JSON.stringify(e))return;const r=[...o];t[0]===e[0]?r.splice(o.length-1,1,e):r.push(e),d(r)}}));const m=s.useCallback(()=>{!document.hidden&&a&&(f.current=!0)},[a]),p=s.useCallback(()=>{f.current&&(i(),f.current=!1)},[i]);s.useEffect(()=>(i(),document.addEventListener("visibilitychange",m),document.addEventListener("click",p),()=>{document.removeEventListener("visibilitychange",m),document.removeEventListener("click",p)}),[i,a,p,m]),s.useEffect(()=>{const e=window.matchMedia("(prefers-color-scheme: dark)");e.matches&&x(!0),e.addEventListener("change",t=>x(t.matches))},[]);const R=s.useCallback(()=>{a||i(),v(!a)},[a,i]),D=s.useMemo(()=>{const e=new Date;return e.setHours(0,0,0,0),e},[]);return n.jsxs("div",{className:`card hourly-chart col ${E||""}`,children:[n.jsxs("div",{className:"row justify-space-between",children:[n.jsx("div",{className:"hourly-chart-title",children:"Hourly Chart"}),n.jsxs("div",{className:"row hourly-chart-buttons",children:[n.jsx("button",{onClick:R,children:a?"Pause auto update":"Allow auto update"}),n.jsx("button",{disabled:!a,onClick:()=>i(),children:"Update"})]})]}),n.jsx("div",{className:"hourly-chart-content col flex-1",children:o.length?n.jsx(H,{type:"line",height:400,series:j,options:{chart:{toolbar:{show:!1},zoom:{enabled:!1}},colors:["rgb(112, 173, 70)","rgb(90, 155, 213)","rgb(246, 104, 103)","rgb(255, 164, 97)","rgb(128, 0, 128)"],stroke:{width:3},theme:{mode:k?"dark":"light"},xaxis:{type:"datetime",min:D.getTime(),labels:{datetimeUTC:!1,format:"HH:mm"}},yaxis:[{seriesName:l,title:{text:"Power (W)"}},{seriesName:l,show:!1},{seriesName:l,show:!1},{seriesName:l,show:!1},{seriesName:"SOC",opposite:!0,tickAmount:10,min:0,max:100,title:{text:"SOC (%)"}}],tooltip:{x:{format:"HH:mm:ss"},y:{formatter(e,t){return t.seriesIndex===4?`${e}%`:`${Math.abs(e)} W`},title:{formatter(e,t){if(e===C){const r=t.series[1][t.dataPointIndex];return r===0?`${e}:`:r<0?`${e} Charging:`:`${e} Discharging:`}if(e===b){const r=t.series[2][t.dataPointIndex];return r===0?`${e}:`:r<0?"Import Grid Power:":"Export Grid Power:"}return`${e}:`}}}}}}):n.jsx(A,{})})]})});w.displayName="HourlyChart";const $=s.memo(w);export{$ as default};
