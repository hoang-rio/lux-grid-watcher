import{r as t,j as e}from"./index--XOPUxLm.js";import{G as d}from"./GeneralValue-pkkstyBm.js";import{C as _}from"./react-apexcharts.min-BLzWBPzu.js";import{f as m,r as y}from"./utils-bN4E_OZW.js";function N({total:i,ePVDay:r}){return e.jsxs("div",{className:"row justify-space-between align-center",children:[e.jsx("img",{src:"/assets/icon_solor_yielding.png"}),e.jsxs("div",{className:"yield-texts summary-item-content-texts ",children:[e.jsx(d,{value:r,unit:" kWh"}),e.jsx("div",{className:"description",children:"Yield today"}),i&&e.jsxs(e.Fragment,{children:[e.jsx(d,{value:i.pv.toFixed(1),unit:" kWh"}),e.jsx("div",{className:"description",children:"Total Yield"})]})]})]})}const w=t.memo(N);function k({totalYield:i,charge:r,gridExport:h,label:a}){const[j,l]=t.useState(!1);let s,x,c,n;return i?(s=i-r-h,x=m(s/i*100),c=m(r/i*100),n=m(h/i*100)):(s=0,x=0,c=0,n=0),t.useEffect(()=>{const u=window.matchMedia("(prefers-color-scheme: dark)");u.matches&&l(!0),u.addEventListener("change",o=>l(o.matches))},[]),e.jsxs("div",{className:"yield-chart row flex-1",children:[e.jsxs("div",{className:"texts col flex-1 align-start justify-space-between",children:[e.jsxs("div",{className:"yield-chart-load",children:[x,"% Load ",a]}),e.jsxs("div",{className:"yield-chart-charge",children:[c,"% Charge ",a]}),e.jsxs("div",{className:"yield-chart-export",children:[n,"% Export ",a]}),e.jsx("div",{className:"yield-chart-total",children:e.jsxs("strong",{children:[a," ",y(i)," kWh"]})})]}),e.jsx("div",{className:"chart row align-center",children:e.jsx(_,{type:"pie",series:[y(s),y(r),y(h)],width:110,options:{colors:["#FF718F","#5CC9A0","#F2A474"],theme:{mode:j?"dark":"light"},labels:[`Load ${a} PV`,`Charge ${a} PV`,`Export ${a} PV`],legend:{show:!1}}})})]})}const f=t.memo(k);function C({invertData:i}){const[r,h]=t.useState(!1),[a,j]=t.useState(!1),l=t.useRef(!1),[s,x]=t.useState(),[c,n]=t.useState(0),u=t.useCallback(()=>{switch(c){case 0:n(1);break;case 1:n(2);break;default:n(0);break}},[c]),o=t.useCallback(async()=>{if(!l.current)try{console.log("Fetching total..."),l.current=!0;const v=await(await fetch("/total")).json();x(v)}catch(p){console.error("Fetch total error",p)}finally{l.current=!1}},[]),g=t.useCallback(()=>{document.hidden||o()},[o]);return t.useEffect(()=>(o(),document.addEventListener("visibilitychange",g),()=>{document.removeEventListener("visibilitychange",g)}),[o,g]),e.jsxs("div",{className:"summary row",children:[e.jsxs("div",{className:"yield summary-item flex-1 col",onClick:u,children:[e.jsx("div",{className:"summary-item-title",children:"Solar Yield"}),e.jsxs("div",{className:"summary-item-content col flex-1",children:[c===0&&e.jsx(w,{total:s,ePVDay:i.e_pv_day}),c===1&&e.jsx(f,{label:"Today",totalYield:i.e_pv_day,charge:i.e_chg_day,gridExport:i.e_to_grid_day}),c===2&&e.jsx(f,{label:"Total",totalYield:(s==null?void 0:s.pv)||0,charge:(s==null?void 0:s.battery_charged)||0,gridExport:(s==null?void 0:s.grid_export)||0})]})]}),e.jsxs("div",{className:"battery summary-item flex-1",onClick:()=>h(!r),children:[e.jsx("div",{className:"summary-item-title",children:r?"Battery Charged":"Battery Discharge"}),e.jsx("div",{className:"summary-item-content",children:e.jsxs("div",{className:"row justify-space-between align-center",children:[e.jsx("img",{src:"/assets/icon_battery_discharging.png"}),e.jsxs("div",{className:"summary-item-content-texts",children:[e.jsx(d,{value:r?i.e_chg_day:i.e_dischg_day,unit:" kWh"}),e.jsx("div",{className:"description",children:r?"Charged today":"Discharged today"}),s&&e.jsxs(e.Fragment,{children:[e.jsx(d,{value:m(r?s.battery_charged:s.battery_discharged),unit:" kWh"}),e.jsxs("div",{className:"description",children:["Total ",r?"Charged":"Discharged"]})]})]})]})})]}),e.jsxs("div",{className:"feed summary-item flex-1",onClick:()=>j(!a),children:[e.jsx("div",{className:"summary-item-title ",children:a?"Feed-in Energy":"Import"}),e.jsx("div",{className:"summary-item-content",children:e.jsxs("div",{className:"row justify-space-between align-center",children:[e.jsx("img",{src:a?"/assets/icon_feed_in_energy.png":"/assets/icon_import.png"}),e.jsx("div",{className:"feed-texts summary-item-content-texts",children:e.jsxs("div",{className:"col",children:[e.jsx(d,{value:a?i.e_to_grid_day:i.e_to_user_day,unit:" kWh"}),e.jsx("div",{className:"description",children:a?"Today Export":"Today Import"}),s&&e.jsxs(e.Fragment,{children:[e.jsx(d,{value:m(a?s.grid_export:s.grid_import),unit:" kWh"}),e.jsxs("div",{className:"description",children:["Total ",a?"Export":"Import"]})]})]})})]})})]}),e.jsxs("div",{className:"comsumption summary-item flex-1",children:[e.jsx("div",{className:"summary-item-title ",children:"Comsumption"}),e.jsx("div",{className:"summary-item-content",children:e.jsxs("div",{className:"row justify-space-between align-center",children:[e.jsx("img",{src:"/assets/icon_consumption.png"}),e.jsxs("div",{className:"feed-texts summary-item-content-texts",children:[e.jsx(d,{value:(i.e_inv_day+i.e_to_user_day+i.e_eps_day-i.e_rec_day).toFixed(1),unit:" kWh"}),e.jsx("div",{className:"description",children:"Today Used"}),s&&e.jsxs(e.Fragment,{children:[e.jsx(d,{value:m(s.consumption),unit:" kWh"}),e.jsx("div",{className:"description",children:"Total Used"})]})]})]})})]})]})}const T=t.memo(C);export{T as default};
